<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Jelszó Visszaállítás</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        /* ... style marad ugyanaz ... */
    </style>
</head>
<body>
    <div class="container">
        <h2>Új jelszó beállítása</h2>
        <div class="form-group">
            <label for="password">Új jelszó:</label>
            <input type="password" id="password" 
                   placeholder="Add meg az új jelszavad" required>
        </div>
        <div class="form-group">
            <label for="confirm-password">Jelszó megerősítése:</label>
            <input type="password" id="confirm-password" 
                   placeholder="Írd be újra a jelszavad" required>
        </div>
        <div id="error-message" class="error"></div>
        <button onclick="updatePassword()">Jelszó mentése</button>
    </div>

    <script>
        // Supabase kliens inicializálása
        const SUPABASE_URL = 'https://wekssjmhbupuedlegalt.supabase.co'
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indla3Nzam1oYnVwdWVkbGVnYWx0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ2MzIxNDIsImV4cCI6MjA1MDIwODE0Mn0.KB4VRFcwsLN4lFTLr1rLCLFCFkCdb-6LZs_lpK5P_s0'
        
        // Helyesen inicializáljuk a Supabase klienst
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
        
        // A hash paramétert kiolvassuk az URL-ből
        const hashParams = new URLSearchParams(window.location.hash.substring(1));
        const access_token = hashParams.get('access_token');
        const refresh_token = hashParams.get('refresh_token');
        const type = hashParams.get('type');

        async function updatePassword() {
            const password = document.getElementById('password').value
            const confirmPassword = document.getElementById('confirm-password').value
            const errorElement = document.getElementById('error-message')

            try {
                errorElement.textContent = '';

                if (!password || !confirmPassword) {
                    errorElement.textContent = 'Kérjük, töltsd ki mindkét mezőt!'
                    return
                }

                if (password !== confirmPassword) {
                    errorElement.textContent = 'A jelszavak nem egyeznek!'
                    return
                }

                if (password.length < 6) {
                    errorElement.textContent = 'A jelszónak legalább 6 karakter hosszúnak kell lennie!'
                    return
                }

                // Az access token-t használjuk a session-höz
                if (access_token) {
                    const { data, error } = await supabase.auth.updateUser({
                        password: password
                    });

                    if (error) throw error

                    alert('A jelszó sikeresen frissítve! Most már bejelentkezhet az alkalmazásba az új jelszóval.')
                    // Opcionálisan átirányíthatunk az alkalmazás kezdőoldalára
                    // window.location.href = 'YOUR_APP_URL';
                } else {
                    errorElement.textContent = 'Érvénytelen vagy lejárt link. Kérjük, kérjen új jelszó-visszaállító e-mailt.'
                }

            } catch (error) {
                errorElement.textContent = 'Hiba történt: ' + error.message
                console.error('Error:', error)
            }
        }
    </script>
</body>
</html>